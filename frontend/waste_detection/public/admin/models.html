<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý AI Models - Admin EcoSort</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="css/admin.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <img src="../images/logo.png" alt="EcoSort">
                <span>EcoSort Admin</span>
            </div>
            <nav class="admin-nav">
                <ul>
                    <li><a href="index.html">
                        <i class="fas fa-chart-line"></i> Dashboard
                    </a></li>
                    <li><a href="users.html">
                        <i class="fas fa-users"></i> Quản lý Users
                    </a></li>
                    <li><a href="models.html" class="active">
                        <i class="fas fa-robot"></i> AI Models
                    </a></li>
                    <li><a href="categories.html">
                        <i class="fas fa-tags"></i> Waste Categories
                    </a></li>
                    <li><a href="feedbacks.html">
                        <i class="fas fa-comments"></i> Feedbacks
                    </a></li>
                    <!-- <li><a href="statistics.html">
                        <i class="fas fa-chart-bar"></i> Thống kê
                    </a></li> -->
                </ul>
            </nav>
            <div class="admin-user-info">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-details">
                    <span class="user-name" id="adminUserName">Admin</span>
                    <span class="user-role">Administrator</span>
                </div>
                <button class="btn-logout" onclick="handleAdminLogout()">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <header class="admin-header">
                <h1 class="page-title">Quản lý AI Models</h1>
                <div class="admin-actions">
                    <button class="btn-admin btn-primary" onclick="showAddModelModal()">
                        <i class="fas fa-plus"></i> Thêm mô hình mới
                    </button>
                    <a href="../index.html" class="btn-back-to-site">
                        <i class="fas fa-home"></i> Về trang chủ
                    </a>
                </div>
            </header>

            <div class="admin-content">
                <!-- Models table -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tên mô hình</th>
                                <th>Version</th>
                                <th>Mô tả</th>
                                <th>Accuracy</th>
                                <th>Precision</th>
                                <th>Recall</th>
                                <th>F1 Score</th>
                                <th>File Path</th>
                                <th>Trạng thái</th>
                                <th>Ngày deploy</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="modelsTableBody">
                            <tr>
                                <td colspan="12" class="loading-text">Đang tải...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal thêm mô hình mới -->
    <div id="addModelModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Thêm mô hình AI mới</h2>
                <button class="modal-close" onclick="closeAddModelModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addModelForm" class="modal-body">
                <div class="form-group">
                    <label for="modelName">Tên mô hình <span class="required">*</span></label>
                    <input type="text" id="modelName" name="name" placeholder="VD: waste_yolov8s" required>
                </div>
                
                <div class="form-group">
                    <label for="modelVersion">Version <span class="required">*</span></label>
                    <input type="text" id="modelVersion" name="version" placeholder="VD: 1.0.0" required>
                </div>
                
                <div class="form-group">
                    <label for="modelDescription">Mô tả</label>
                    <textarea id="modelDescription" name="description" rows="3" placeholder="Mô tả về mô hình..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="modelFilePath">Đường dẫn file mô hình <span class="required">*</span></label>
                    <input type="text" id="modelFilePath" name="file_path" 
                           placeholder="VD: weights\yolo11n\weights\best.pt" required>
                    <small class="form-hint">Đường dẫn đến file .pt của mô hình đã huấn luyện</small>
                </div>
                
                <div class="form-group">
                    <label for="resultsCsvFile">File results.csv (để tính metrics)</label>
                    <input type="file" id="resultsCsvFile" name="results_csv" accept=".csv">
                    <small class="form-hint">Upload file results.csv từ thư mục mô hình để tự động tính metrics</small>
                </div>
                
                <!-- Metrics sẽ được tự động điền sau khi upload CSV -->
                <div id="metricsPreview" style="display: none;">
                    <h4>Metrics tự động tính toán:</h4>
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <label>Accuracy (mAP50):</label>
                            <span id="previewAccuracy">-</span>
                        </div>
                        <div class="metric-item">
                            <label>Precision:</label>
                            <span id="previewPrecision">-</span>
                        </div>
                        <div class="metric-item">
                            <label>Recall:</label>
                            <span id="previewRecall">-</span>
                        </div>
                        <div class="metric-item">
                            <label>F1 Score:</label>
                            <span id="previewF1Score">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-container">
                        <input type="checkbox" id="modelIsActive" name="is_active">
                        <span class="checkmark"></span>
                        Kích hoạt mô hình này (sẽ tự động tắt các mô hình khác)
                    </label>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn-admin btn-secondary" onclick="closeAddModelModal()">
                        Hủy
                    </button>
                    <button type="submit" class="btn-admin btn-primary">
                        <i class="fas fa-save"></i> Lưu mô hình
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="../js/supabase-config.js"></script>
    <script src="js/admin-main.js"></script>
    <script src="js/admin-models.js"></script>
    <script>
        // Make PapaParse available globally
        window.Papa = Papa;
    </script>
</body>
</html>

